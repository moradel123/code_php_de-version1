<?php
header('Content-Type: application/json');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Headers: Content-Type');
header('Access-Control-Allow-Methods: POST, OPTIONS');

// Connexion PDO
require_once 'db_connect.php';

// Lire les donnÃ©es JSON
$raw = file_get_contents("php://input");
$data = json_decode($raw, true);

// Debug
error_log("ğŸ” RAW JSON: $raw");
error_log("ğŸ” Data dÃ©codÃ©e: " . print_r($data, true));

// VÃ©rification des donnÃ©es reÃ§ues
if (!isset($data['id_rdv']) || !isset($data['description'])) {
    error_log("âŒ Champs manquants dans la requÃªte");
    echo json_encode(['success' => false, 'message' => 'Champs manquants']);
    exit;
}

$id_rdv = intval($data['id_rdv']);
$description = trim($data['description']);

// ExÃ©cution de la requÃªte avec PDO
try {
    $stmt = $pdo->prepare("UPDATE appointments SET description = ? WHERE id = ?");
    $stmt->execute([$description, $id_rdv]);

    error_log("âœ… Description mise Ã  jour avec succÃ¨s");
    echo json_encode(['success' => true, 'message' => 'Description mise Ã  jour']);
} catch (PDOException $e) {
    error_log("âŒ Erreur PDO: " . $e->getMessage());
    echo json_encode(['success' => false, 'message' => 'Erreur lors de la mise Ã  jour', 'error' => $e->getMessage()]);
}
